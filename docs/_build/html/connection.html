

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>connection &mdash; Pika 0.9.2a documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.2a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Pika 0.9.2a documentation" href="index.html" />
    <link rel="next" title="credentials" href="credentials.html" />
    <link rel="prev" title="channel" href="channel.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="credentials.html" title="credentials"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="channel.html" title="channel"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Pika 0.9.2a documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="connection">
<h1>connection<a class="headerlink" href="#connection" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following class level documentation is not intended for use by those using Pika in their applications. This documentation is for those who are extending Pika or otherwise working on the driver itself. For an overview of how to use adapters, please reference the <a class="reference internal" href="connecting.html"><em>Connecting to RabbitMQ</em></a> documentation.</p>
</div>
<span class="target" id="module-connection"></span><div class="section" id="id1">
<h2>Connection<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt>
<em class="property">class </em><tt class="descclassname">connection.</tt><tt class="descname">Connection</tt><big>(</big><em>parameters=None</em>, <em>on_open_callback=None</em>, <em>reconnection_strategy=None</em><big>)</big></dt>
<dd><p>Pika Connection Class</p>
<p>This is the core class that implements communication with RabbitMQ. This
class should not be invoked directly but rather through the use of an
adapter such as SelectConnection or BlockingConnection.</p>
<p>Connection initialization expects a ConnectionParameters object and
a callback function to notify when we have successfully connected
to the AMQP Broker.</p>
<p>A reconnection_strategy of None will use the NullReconnectionStrategy</p>
<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_adapter__disconnect</tt><big>(</big><big>)</big></dt>
<dd><p>Subclasses should override this to cause the underlying
transport (socket) to close.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_adapter_connect</tt><big>(</big><em>host</em>, <em>port</em><big>)</big></dt>
<dd><p>Subclasses should override to set up the outbound socket connection</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_combine</tt><big>(</big><em>a</em>, <em>b</em><big>)</big></dt>
<dd><p>Pass in two values, if a is 0, return b otherwise if b is 0, return a.
If neither case matches return the smallest value.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_connect</tt><big>(</big><big>)</big></dt>
<dd><p>Call the Adapter&#8217;s connect method after letting the
ReconnectionStrategy know that we&#8217;re going to do so.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_ensure_closed</tt><big>(</big><big>)</big></dt>
<dd><p>If we&#8217;re not already closed, make sure we&#8217;re closed</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_erase_credentials</tt><big>(</big><big>)</big></dt>
<dd><p>Override if in some context you need the object to forget
its login credentials after successfully opening a connection.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_flush_outbound</tt><big>(</big><big>)</big></dt>
<dd><p>Adapters should override to flush the contents of
outbound_buffer out along the socket.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_init_connection_state</tt><big>(</big><big>)</big></dt>
<dd><p>Initialize or reset all of our internal state variables for a given
connection. If we disconnect and reconnect, all of our state needs to
be wiped</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_next_channel_number</tt><big>(</big><big>)</big></dt>
<dd><p>Return the next available channel number or raise on exception</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_on_channel_close</tt><big>(</big><em>frame</em><big>)</big></dt>
<dd><p>RPC Response from when a channel closes itself, remove from our stack</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_on_close_ready</tt><big>(</big><big>)</big></dt>
<dd><p>On a clean shutdown we&#8217;ll call this once all of our channels are closed
Let the Broker know we want to close</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_on_connected</tt><big>(</big><big>)</big></dt>
<dd><p>This is called by our connection Adapter to let us know that we&#8217;ve
connected and we can notify our connection strategy</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_on_connection_closed</tt><big>(</big><em>frame</em>, <em>from_adapter=False</em><big>)</big></dt>
<dd><p>Let both our RS and Event object know we closed</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_on_connection_open</tt><big>(</big><em>frame</em><big>)</big></dt>
<dd><p>This is called once we have tuned the connection with the server and
called the Connection.Open on the server and it has replied with
Connection.Ok.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_on_connection_start</tt><big>(</big><em>frame</em><big>)</big></dt>
<dd><p>This is called as a callback once we have received a Connection.Start
from the server.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_on_connection_tune</tt><big>(</big><em>frame</em><big>)</big></dt>
<dd><p>Once the Broker sends back a Connection.Tune, we will set our tuning
variables that have been returned to us and kick off the Heartbeat
monitor if required, send our TuneOk and then the Connection. Open rpc
call on channel 0</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_on_data_available</tt><big>(</big><em>data</em><big>)</big></dt>
<dd><p>This is called by our Adapter, passing in the data from the socket
As long as we have buffer try and map out frame data</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_on_remote_close</tt><big>(</big><em>frame</em><big>)</big></dt>
<dd><p>We&#8217;ve received a remote close from the server</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_reconnect</tt><big>(</big><big>)</big></dt>
<dd><p>Called by the Reconnection Strategy classes or Adapters to disconnect
and reconnect to the broker</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_rpc</tt><big>(</big><em>channel_number</em>, <em>method</em>, <em>callback=None</em>, <em>acceptable_replies=</em><span class="optional">[</span><span class="optional">]</span><big>)</big></dt>
<dd><p>Make an RPC call for the given callback, channel number and method.
acceptable_replies lists out what responses we&#8217;ll process from the
server with the specified callback.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_send_frame</tt><big>(</big><em>frame</em><big>)</big></dt>
<dd><p>This appends the fully generated frame to send to the broker to the
output buffer which will be then sent via the connection adapter</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_send_method</tt><big>(</big><em>channel_number</em>, <em>method</em>, <em>content=None</em><big>)</big></dt>
<dd><p>Constructs a RPC method frame and then sends it to the broker</p>
</dd></dl>

<dl class="attribute">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">_suggested_buffer_size</tt></dt>
<dd><p>Return the suggested buffer size from the connection state/tune or the
default if that is None</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">add_backpressure_callback</tt><big>(</big><em>callback</em><big>)</big></dt>
<dd><p>Add a callback notification when we think backpressue is being applied
due to the size of the output buffer being exceeded.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">add_on_close_callback</tt><big>(</big><em>callback</em><big>)</big></dt>
<dd><p>Add a callback notification when the connection has closed</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">add_on_open_callback</tt><big>(</big><em>callback</em><big>)</big></dt>
<dd><p>Add a callback notification when the connection has opened</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">add_timeout</tt><big>(</big><em>delay_sec</em>, <em>callback</em><big>)</big></dt>
<dd><p>Adapters should override to call the callback after the
specified number of seconds have elapsed, using a timer, or a
thread, or similar.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">channel</tt><big>(</big><em>on_open_callback</em>, <em>channel_number=None</em><big>)</big></dt>
<dd><p>Create a new channel with the next available channel number or pass in
a channel number to use. Must be non-zero if you would like to specify
but it is recommended that you let Pika manage the channel numbers.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">close</tt><big>(</big><em>code=200</em>, <em>text='Normal shutdown'</em><big>)</big></dt>
<dd><p>Disconnect from RabbitMQ. If there are any open channels, it will
attempt to close them prior to fully disconnecting. Channels which
have active consumers will attempt to send a Basic.Cancel to RabbitMQ
to cleanly stop the delivery of messages prior to closing the channel.</p>
</dd></dl>

<dl class="attribute">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">is_open</tt></dt>
<dd><p>Returns a boolean reporting the current connection state</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">remove_timeout</tt><big>(</big><em>callback</em><big>)</big></dt>
<dd><p>Adapters should override to call the callback after the
specified number of seconds have elapsed, using a timer, or a
thread, or similar.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">Connection.</tt><tt class="descname">set_backpressure_multiplier</tt><big>(</big><em>value=10</em><big>)</big></dt>
<dd><p>Alter the backpressure multiplier value. We set this to 10 by default.
This value is used to raise warnings and trigger the backpressure
callback.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="connectionstate">
<h2>ConnectionState<a class="headerlink" href="#connectionstate" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="connection.ConnectionState">
<em class="property">class </em><tt class="descclassname">connection.</tt><tt class="descname">ConnectionState</tt><a class="headerlink" href="#connection.ConnectionState" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="connection.ConnectionState.FOOTER_SIZE">
<tt class="descname">FOOTER_SIZE</tt><em class="property"> = 1</em><a class="headerlink" href="#connection.ConnectionState.FOOTER_SIZE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="connection.ConnectionState.HEADER_SIZE">
<tt class="descname">HEADER_SIZE</tt><em class="property"> = 7</em><a class="headerlink" href="#connection.ConnectionState.HEADER_SIZE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="connection.ConnectionState._inbound">
<tt class="descname">_inbound</tt><big>(</big><big>)</big><a class="headerlink" href="#connection.ConnectionState._inbound" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="connection.ConnectionState._return_to_idle">
<tt class="descname">_return_to_idle</tt><big>(</big><big>)</big><a class="headerlink" href="#connection.ConnectionState._return_to_idle" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="connection.ConnectionState._waiting_for_body">
<tt class="descname">_waiting_for_body</tt><big>(</big><em>inbound</em><big>)</big><a class="headerlink" href="#connection.ConnectionState._waiting_for_body" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="connection.ConnectionState._waiting_for_header">
<tt class="descname">_waiting_for_header</tt><big>(</big><em>inbound</em><big>)</big><a class="headerlink" href="#connection.ConnectionState._waiting_for_header" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="connection.ConnectionState._waiting_for_protocol_header">
<tt class="descname">_waiting_for_protocol_header</tt><big>(</big><em>inbound</em><big>)</big><a class="headerlink" href="#connection.ConnectionState._waiting_for_protocol_header" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="connection.ConnectionState.handle_input">
<tt class="descname">handle_input</tt><big>(</big><em>received_data</em><big>)</big><a class="headerlink" href="#connection.ConnectionState.handle_input" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="connection.ConnectionState.tune">
<tt class="descname">tune</tt><big>(</big><em>channel_max</em>, <em>frame_max</em><big>)</big><a class="headerlink" href="#connection.ConnectionState.tune" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">connection</a><ul>
<li><a class="reference internal" href="#id1">Connection</a></li>
<li><a class="reference internal" href="#connectionstate">ConnectionState</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="channel.html"
                        title="previous chapter">channel</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="credentials.html"
                        title="next chapter">credentials</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/connection.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="credentials.html" title="credentials"
             >next</a> |</li>
        <li class="right" >
          <a href="channel.html" title="channel"
             >previous</a> |</li>
        <li><a href="index.html">Pika 0.9.2a documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Tony Garnock-Jones, Gavin M. Roy and others.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1pre.
    </div>
  </body>
</html>